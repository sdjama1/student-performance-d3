<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Performance Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      padding: 20px;
    }

    h2 {
      margin-bottom: 4px;
    }

    #controls {
      margin-bottom: 12px;
    }

    svg {
      background: white;
      border: 1px solid #ccc;
    }

    .tooltip {
      position: absolute;
      background: white;
      border: 1px solid #999;
      padding: 6px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
    }

    .axis-label {
      font-size: 12px;
    }
  </style>
</head>
<body>

<h2>interactive exploration of student performance</h2>
<p>use the dropdown to explore how different factors relate to performance index</p>

<div id="controls">
  x-axis variable:
  <select id="xSelect">
    <option value="hours">hours studied</option>
    <option value="sleep">sleep hours</option>
    <option value="papers">question papers practiced</option>
    <option value="previous">previous scores</option>
  </select>
</div>

<svg width="800" height="500"></svg>
<div class="tooltip"></div>

<script>
const svg = d3.select("svg"),
      margin = {top: 40, right: 40, bottom: 60, left: 70},
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom;

const g = svg.append("g")
  .attr("transform", `translate(${margin.left},${margin.top})`);

const tooltip = d3.select(".tooltip");

const xScale = d3.scaleLinear().range([0, width]);
const yScale = d3.scaleLinear().range([height, 0]);

const xAxisGroup = g.append("g")
  .attr("transform", `translate(0,${height})`);

const yAxisGroup = g.append("g");

const xLabel = g.append("text")
  .attr("class", "axis-label")
  .attr("x", width / 2)
  .attr("y", height + 45)
  .attr("text-anchor", "middle");

const yLabel = g.append("text")
  .attr("class", "axis-label")
  .attr("transform", "rotate(-90)")
  .attr("x", -height / 2)
  .attr("y", -50)
  .attr("text-anchor", "middle")
  .text("performance index");

const color = d3.scaleOrdinal()
  .domain(["Yes", "No"])
  .range(["#1f77b4", "#ff7f0e"]);

d3.csv("StudentPerformance.csv").then(data => {

  data.forEach(d => {
    d.hours = +d["Hours Studied"];
    d.sleep = +d["Sleep Hours"];
    d.papers = +d["Sample Question Papers Practiced"];
    d.previous = +d["Previous Scores"];
    d.performance = +d["Performance Index"];
    d.extra = d["Extracurricular Activities"];
  });

  function update(xVar) {

    xScale.domain(d3.extent(data, d => d[xVar])).nice();
    yScale.domain(d3.extent(data, d => d.performance)).nice();

    xAxisGroup.call(d3.axisBottom(xScale));
    yAxisGroup.call(d3.axisLeft(yScale));

    const labels = {
      hours: "hours studied",
      sleep: "sleep hours",
      papers: "question papers practiced",
      previous: "previous scores"
    };

    xLabel.text(labels[xVar]);

    const circles = g.selectAll("circle")
      .data(data);

    circles.enter()
      .append("circle")
      .attr("r", 5)
      .merge(circles)
      .transition()
      .duration(600)
      .attr("cx", d => xScale(d[xVar]))
      .attr("cy", d => yScale(d.performance))
      .attr("fill", d => color(d.extra));

    g.selectAll("circle")
      .on("mouseover", (event, d) => {
        tooltip
          .style("opacity", 1)
          .html(`
            hours studied: ${d.hours}<br>
            sleep hours: ${d.sleep}<br>
            papers practiced: ${d.papers}<br>
            previous score: ${d.previous}<br>
            extracurricular: ${d.extra}<br>
            performance index: ${d.performance}
          `)
          .style("left", event.pageX + 10 + "px")
          .style("top", event.pageY - 20 + "px");
      })
      .on("mouseout", () => tooltip.style("opacity", 0));

    circles.exit().remove();
  }

  update("hours");

  d3.select("#xSelect").on("change", function () {
    update(this.value);
  });

});
</script>

</body>
</html>
